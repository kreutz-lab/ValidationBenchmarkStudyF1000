# This function converts a path generated by bs_getPath to the prefix that is added to filenames
#
# A similar job is done by bs_processResultFoldernames()
# 
# Examples:
# bs_path2prefix(bs_getPath(5.4,"msp",nearing = T,partReg = T))
# bs_path2prefix(bs_getPath(5.4,"spd",nearing = F,partReg = F,"Aim2_secondary"))
#
# # Testing all combinations:
# for(analysis in 3:5){
#   if(analysis %in% c(3,4)){
#     addAll <- c(0.1,0.2,0.3,0.4)
#   }else{
#     addAll <- c(0.1,0.2)
#   }
#   for(toAdd in addAll){
#     number = analysis+toAdd
#     for(simulator in c("msp","spd")){
#       for(nearing in c(T,F)){
#         for(partReg in c(T,F)){
#           pfad <- bs_getPath(number,simulator, nearing = nearing ,partReg = partReg)
#           prefix <- bs_path2prefix(pfad)
#           cat(prefix,"\t",pfad,"\n")
#           
#           if(analysis==5){
#             pfad <- bs_getPath(number,simulator, nearing = nearing ,partReg = partReg,nameAim2 = "Aim2_primary")
#             prefix <- bs_path2prefix(pfad)
#             cat(prefix,"\t",pfad,"\n")
#           }
#         }
#       }
#     }
#   }
# }


bs_path2prefix <- function(path){
  if(length(path)>1){
    prefix <- array(dim=length(path))
    for(i in 1:length(path)){
      prefix[i] <- bs_path2prefix(path[i])
    }
  } else {
    
    isPartReg <- grepl("partReg",path,ignore.case = T)
    
    prefix <- basename(path)
    prefix <- sub("metaSPARSim","msp",prefix,ignore.case = T)
    prefix <- sub("sparseDOSSA","spd",prefix,ignore.case = T)
    prefix <- sub("_filtered+nonFiltered","_filt+nonFilt",prefix,ignore.case = T)
    prefix <- sub("_filtered","_filt",prefix,ignore.case = T)
    prefix <- sub("_ZerosAdded","_add0",prefix,ignore.case = T)
    prefix <- sub("_ancom_Nearing","_ancomNear",prefix,ignore.case = T)
    prefix <- sub("_DataProps","",prefix,ignore.case = T)
    prefix <- sub("_DA","",prefix,ignore.case = F)
    
    if(isPartReg){
      # replace msp -> msp_pr or spd -> spd_pr or add _pr at the end:
      if(grepl("msp",prefix)){
        prefix <- sub("msp","msp_pr",prefix)        
      }else{
        if(grepl("spd",prefix)){
          prefix <- sub("spd","spd_pr",prefix)        
        }else{
          prefix <- paste0(prefix,"_pr")
        }
      }
    }
    
    # add _ at the end:
    prefix <- paste0(prefix,"_")
  }
  
  return(prefix)
}